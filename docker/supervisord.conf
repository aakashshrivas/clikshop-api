[supervisord]
nodaemon=true

[program:php-fpm]
command=docker-php-entrypoint php-fpm
autostart=true
autorestart=true

[program:nginx]
command=nginx -g "daemon off;"
autostart=true
autorestart=true

# Run Laravel setup on container start
[program:laravel-setup]
command=sh -c "
    if [ -z \"$APP_KEY\" ]; then php artisan key:generate --force; fi && \
    php artisan storage:link --force && \
    php artisan migrate --force
"
autostart=true
autorestart=false
priority=5
